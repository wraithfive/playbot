# Server Configuration
server.port=8080

# Application Name
spring.application.name=color-gacha-bot

# OAuth2 Configuration for Discord
spring.security.oauth2.client.registration.discord.client-id=${DISCORD_CLIENT_ID}
spring.security.oauth2.client.registration.discord.client-secret=${DISCORD_CLIENT_SECRET}
spring.security.oauth2.client.registration.discord.scope=identify,guilds
spring.security.oauth2.client.registration.discord.authorization-grant-type=authorization_code
spring.security.oauth2.client.registration.discord.redirect-uri={baseUrl}/login/oauth2/code/{registrationId}

spring.security.oauth2.client.provider.discord.authorization-uri=https://discord.com/api/oauth2/authorize
spring.security.oauth2.client.provider.discord.token-uri=https://discord.com/api/oauth2/token
spring.security.oauth2.client.provider.discord.user-info-uri=https://discord.com/api/users/@me
spring.security.oauth2.client.provider.discord.user-name-attribute=id

# Session Configuration
# Use Spring Session (JDBC) to persist sessions so OAuth2 logins survive restarts
spring.session.store-type=jdbc
# Disable auto-initialization - Liquibase manages schema
spring.session.jdbc.initialize-schema=never

# OAuth2 Client Configuration
# Disable auto-initialization - Liquibase manages oauth2_authorized_client table
spring.sql.init.mode=never

# Default session timeout (server-side). Keep moderate; cookie lifetime controls persistence client-side.
server.servlet.session.timeout=30d

# Session cookie settings
server.servlet.session.cookie.http-only=true
# For local dev: secure=false (allows HTTP), samesite=lax (allows OAuth redirects)
# For production: set COOKIE_SECURE=true and COOKIE_SAME_SITE=strict via env vars
server.servlet.session.cookie.secure=${COOKIE_SECURE:false}
server.servlet.session.cookie.same-site=${COOKIE_SAME_SITE:lax}
# Persist the session cookie to emulate "remember me" for OAuth2 (30 days)
server.servlet.session.cookie.max-age=30d

# Respect X-Forwarded-* / Forwarded headers when building request URLs (helps {baseUrl} behind proxies)
server.forward-headers-strategy=framework
server.tomcat.remoteip.remote-ip-header=X-Forwarded-For
server.tomcat.remoteip.protocol-header=X-Forwarded-Proto
server.tomcat.remoteip.protocol-header-https-value=https

# OAuth2 client redirect URI resolution logs (set to DEBUG only when troubleshooting)
logging.level.org.springframework.security.oauth2.client.web=INFO

# H2 Database Configuration (file-based for persistence)
spring.datasource.url=jdbc:h2:file:./data/playbot
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=

# HikariCP Connection Pool Configuration (Phase 9: Performance & Optimization)
# H2 file-based database is single-threaded for writes, so we keep pool modest
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1200000
spring.datasource.hikari.pool-name=PlaybotHikariPool
# Enable connection leak detection (log if connection held > 60 seconds)
spring.datasource.hikari.leak-detection-threshold=60000

# JPA/Hibernate Configuration
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
# Disable Hibernate's auto DDL since we're using Liquibase for migrations
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true

# Liquibase Configuration
spring.liquibase.enabled=true
spring.liquibase.change-log=classpath:/db/changelog/db.changelog-master.xml

# H2 Console (optional, for debugging - disabled by default)
spring.h2.console.enabled=false
# To enable: set to true and access at http://localhost:8080/h2-console
# spring.h2.console.path=/h2-console

# Logging
# Set to INFO for production, DEBUG for development
logging.level.com.discordbot=INFO
logging.level.com.discordbot.battle=INFO
logging.level.org.springframework=INFO
logging.level.org.springframework.security=INFO
logging.level.org.hibernate.SQL=WARN

# Battle System Configuration
battle.enabled=true
battle.debug=false

# D&D 5e Character Creation (Point-Buy)
battle.character.pointBuy.totalPoints=27
battle.character.pointBuy.minScore=8
battle.character.pointBuy.maxScore=15
battle.character.pointBuy.defaultScore=10
battle.character.pointBuy.costs=0,1,2,3,4,5,7,9

# Class Base HP (D&D 5e Hit Die Maximum - Level 1 starting HP)
# At level 1: HP = hitDieMax + CON modifier
# Future leveling (Phase 6): Each level after 1st adds average of hit die + CON modifier
# Fighter (Warrior): d10 hit die -> max 10
# Rogue: d8 hit die -> max 8
# Wizard (Mage): d6 hit die -> max 6
# Cleric: d8 hit die -> max 8
battle.classConfig.warrior.baseHp=10
battle.classConfig.rogue.baseHp=8
battle.classConfig.mage.baseHp=6
battle.classConfig.cleric.baseHp=8

# Combat & Duel Settings
battle.combat.crit.threshold=20
battle.combat.crit.multiplier=2.0
battle.combat.turn.timeoutSeconds=45
battle.combat.cooldownSeconds=60
battle.combat.maxConcurrentPerGuild=50

# Challenge Settings
# battle.challenge.expireSeconds controls how long a pending duel challenge remains accept-able.
# Set to 0 to expire immediately (useful for tests) — challenges will be posted and then expire
# right away, so they cannot be accepted. Use a positive value (e.g., 60–300) for normal usage.
battle.challenge.expireSeconds=120

# Progression
battle.progression.proficiencyByLevel=2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6
battle.progression.elo.k=32
# D&D 5e standard XP curve extended to level 20
battle.progression.xp.levelCurve=0,300,900,2700,6500,14000,23000,34000,48000,64000,85000,100000,120000,140000,165000,195000,225000,265000,305000,355000
# Battle XP rewards (reduced to be a small bonus - chat XP is the primary source)
battle.progression.xp.baseXp=20
battle.progression.xp.winBonus=30
battle.progression.xp.drawBonus=10
# Chat-based XP (primary progression source)
battle.progression.chatXp.enabled=true
battle.progression.chatXp.baseXp=10
battle.progression.chatXp.bonusXpMax=5
battle.progression.chatXp.cooldownSeconds=60
battle.progression.chatXp.levelUpNotification=true
battle.progression.chatXp.autoCreateCharacter=true

# Battle Scheduler Configuration (Phase 3b - Anti-abuse)
# Enable/disable automatic timeout checking
battle.scheduler.timeout.enabled=true
# How often to check for stale battles (milliseconds) - default: 30 seconds
battle.scheduler.timeout.checkIntervalMs=30000
# How often to cleanup expired challenges (milliseconds) - default: 2 minutes
battle.scheduler.cleanup.checkIntervalMs=120000
