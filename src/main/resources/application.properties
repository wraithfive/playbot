# Server Configuration
server.port=8080

# Application Name
spring.application.name=color-gacha-bot

# OAuth2 Configuration for Discord
spring.security.oauth2.client.registration.discord.client-id=${DISCORD_CLIENT_ID}
spring.security.oauth2.client.registration.discord.client-secret=${DISCORD_CLIENT_SECRET}
spring.security.oauth2.client.registration.discord.scope=identify,guilds
spring.security.oauth2.client.registration.discord.authorization-grant-type=authorization_code
spring.security.oauth2.client.registration.discord.redirect-uri={baseUrl}/login/oauth2/code/{registrationId}

spring.security.oauth2.client.provider.discord.authorization-uri=https://discord.com/api/oauth2/authorize
spring.security.oauth2.client.provider.discord.token-uri=https://discord.com/api/oauth2/token
spring.security.oauth2.client.provider.discord.user-info-uri=https://discord.com/api/users/@me
spring.security.oauth2.client.provider.discord.user-name-attribute=id

# Session Configuration
# Use Spring Session (JDBC) to persist sessions so OAuth2 logins survive restarts
spring.session.store-type=jdbc
spring.session.jdbc.initialize-schema=always

# OAuth2 Client Configuration
# Initialize the oauth2_authorized_client table for storing OAuth2 tokens
spring.sql.init.mode=always
spring.sql.init.continue-on-error=true

# Default session timeout (server-side). Keep moderate; cookie lifetime controls persistence client-side.
server.servlet.session.timeout=30d

# Session cookie settings
server.servlet.session.cookie.http-only=true
# For local dev: secure=false (allows HTTP), samesite=lax (allows OAuth redirects)
# For production: set COOKIE_SECURE=true and COOKIE_SAME_SITE=strict via env vars
server.servlet.session.cookie.secure=${COOKIE_SECURE:false}
server.servlet.session.cookie.same-site=${COOKIE_SAME_SITE:lax}
# Persist the session cookie to emulate "remember me" for OAuth2 (30 days)
server.servlet.session.cookie.max-age=30d

# Respect X-Forwarded-* / Forwarded headers when building request URLs (helps {baseUrl} behind proxies)
server.forward-headers-strategy=framework
server.tomcat.remoteip.remote-ip-header=X-Forwarded-For
server.tomcat.remoteip.protocol-header=X-Forwarded-Proto
server.tomcat.remoteip.protocol-header-https-value=https

# Focused debug logging for OAuth2 client redirect URI resolution
logging.level.org.springframework.security.oauth2.client.web=DEBUG

# H2 Database Configuration (file-based for persistence)
spring.datasource.url=jdbc:h2:file:./data/playbot;AUTO_SERVER=TRUE
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=

# JPA/Hibernate Configuration
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true

# H2 Console (optional, for debugging - disabled by default)
spring.h2.console.enabled=false
# To enable: set to true and access at http://localhost:8080/h2-console
# spring.h2.console.path=/h2-console

# Logging
logging.level.com.discordbot=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN
