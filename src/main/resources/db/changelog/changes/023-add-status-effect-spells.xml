<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
    http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.20.xsd">

    <!--
        Phase 4: Add spells and abilities that apply status effects
        Effect format: "DAMAGE+X,APPLY_STATUS:TYPE:DURATION:STACKS:MAGNITUDE"
        - TYPE: STUN, BURN, POISON, REGEN, SHIELD, HASTE, SLOW, etc.
        - DURATION: Number of turns
        - STACKS: Number of stacks to apply
        - MAGNITUDE: Power of the effect (damage/healing per turn, AC bonus, etc.)
    -->

    <!-- Mage Status Effect Spells -->
    <changeSet id="023-add-mage-status-effect-spells" author="claude">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="ability"/>
        </preConditions>

        <!-- Fireball - Upgrade existing to add Burn effect (already exists from migration 016) -->
        <update tableName="ability">
            <column name="effect" value="DAMAGE+12,APPLY_STATUS:BURN:3:1:3"/>
            <column name="description" value="Hurl a ball of fire dealing 12 damage and applying Burn (3 damage per turn for 3 turns)."/>
            <column name="spell_slot_level" valueNumeric="3"/>
            <column name="rest_type" value="LONG_REST"/>
            <column name="updated_at" valueComputed="CURRENT_TIMESTAMP"/>
            <where>ability_key = 'fireball'</where>
        </update>

        <!-- Shocking Grasp - Stun effect -->
        <insert tableName="ability">
            <column name="ability_key" value="shocking-grasp"/>
            <column name="name" value="Shocking Grasp"/>
            <column name="type" value="SPELL"/>
            <column name="class_restriction" value="Mage"/>
            <column name="required_level" value="1"/>
            <column name="prerequisites" value=""/>
            <column name="effect" value="DAMAGE+8,APPLY_STATUS:STUN:1:1:0"/>
            <column name="description" value="Lightning damage that stuns the target for 1 turn."/>
            <column name="spell_slot_level" valueNumeric="0"/>
            <column name="cooldown_seconds" valueNumeric="60"/>
            <column name="rest_type" value="SHORT_REST"/>
            <column name="created_at" valueComputed="CURRENT_TIMESTAMP"/>
            <column name="updated_at" valueComputed="CURRENT_TIMESTAMP"/>
        </insert>

        <!-- Haste - Speed buff -->
        <insert tableName="ability">
            <column name="ability_key" value="haste-spell"/>
            <column name="name" value="Haste"/>
            <column name="type" value="SPELL"/>
            <column name="class_restriction" value="Mage"/>
            <column name="required_level" value="1"/>
            <column name="prerequisites" value=""/>
            <column name="effect" value="APPLY_STATUS:HASTE:3:1:2"/>
            <column name="description" value="Grant an ally +2 to attack rolls and AC for 3 turns."/>
            <column name="spell_slot_level" valueNumeric="3"/>
            <column name="cooldown_seconds" valueNumeric="0"/>
            <column name="rest_type" value="LONG_REST"/>
            <column name="created_at" valueComputed="CURRENT_TIMESTAMP"/>
            <column name="updated_at" valueComputed="CURRENT_TIMESTAMP"/>
        </insert>

        <!-- Slow - Speed debuff -->
        <insert tableName="ability">
            <column name="ability_key" value="slow-spell"/>
            <column name="name" value="Slow"/>
            <column name="type" value="SPELL"/>
            <column name="class_restriction" value="Mage"/>
            <column name="required_level" value="1"/>
            <column name="prerequisites" value=""/>
            <column name="effect" value="APPLY_STATUS:SLOW:3:1:2"/>
            <column name="description" value="Reduce an enemy's attack rolls and AC by 2 for 3 turns."/>
            <column name="spell_slot_level" valueNumeric="3"/>
            <column name="cooldown_seconds" valueNumeric="0"/>
            <column name="rest_type" value="LONG_REST"/>
            <column name="created_at" valueComputed="CURRENT_TIMESTAMP"/>
            <column name="updated_at" valueComputed="CURRENT_TIMESTAMP"/>
        </insert>
    </changeSet>

    <!-- Rogue Poison Spells -->
    <changeSet id="023-add-rogue-poison-spells" author="claude">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="ability"/>
        </preConditions>

        <!-- Poison Strike -->
        <insert tableName="ability">
            <column name="ability_key" value="poison-strike"/>
            <column name="name" value="Poison Strike"/>
            <column name="type" value="SKILL"/>
            <column name="class_restriction" value="Rogue"/>
            <column name="required_level" value="1"/>
            <column name="prerequisites" value=""/>
            <column name="effect" value="DAMAGE+6,APPLY_STATUS:POISON:4:2:2"/>
            <column name="description" value="Strike with a poisoned blade, dealing 6 damage and applying Poison (2 damage per turn for 4 turns, stacks 2x)."/>
            <column name="spell_slot_level" valueNumeric="0"/>
            <column name="cooldown_seconds" valueNumeric="45"/>
            <column name="rest_type" value="SHORT_REST"/>
            <column name="created_at" valueComputed="CURRENT_TIMESTAMP"/>
            <column name="updated_at" valueComputed="CURRENT_TIMESTAMP"/>
        </insert>

        <!-- Crippling Blow - Weakness debuff -->
        <insert tableName="ability">
            <column name="ability_key" value="crippling-blow"/>
            <column name="name" value="Crippling Blow"/>
            <column name="type" value="SKILL"/>
            <column name="class_restriction" value="Rogue"/>
            <column name="required_level" value="1"/>
            <column name="prerequisites" value=""/>
            <column name="effect" value="DAMAGE+8,APPLY_STATUS:WEAKNESS:2:1:30"/>
            <column name="description" value="A devastating strike that reduces the target's damage by 30% for 2 turns."/>
            <column name="spell_slot_level" valueNumeric="0"/>
            <column name="cooldown_seconds" valueNumeric="60"/>
            <column name="rest_type" value="SHORT_REST"/>
            <column name="created_at" valueComputed="CURRENT_TIMESTAMP"/>
            <column name="updated_at" valueComputed="CURRENT_TIMESTAMP"/>
        </insert>
    </changeSet>

    <!-- Cleric Healing and Protection Spells -->
    <changeSet id="023-add-cleric-status-effect-spells" author="claude">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="ability"/>
        </preConditions>

        <!-- Regeneration -->
        <insert tableName="ability">
            <column name="ability_key" value="regeneration"/>
            <column name="name" value="Regeneration"/>
            <column name="type" value="SPELL"/>
            <column name="class_restriction" value="Cleric"/>
            <column name="required_level" value="1"/>
            <column name="prerequisites" value=""/>
            <column name="effect" value="HEAL+5,APPLY_STATUS:REGEN:3:1:4"/>
            <column name="description" value="Heal for 5 HP immediately and grant Regeneration (4 HP per turn for 3 turns)."/>
            <column name="spell_slot_level" valueNumeric="2"/>
            <column name="cooldown_seconds" valueNumeric="0"/>
            <column name="rest_type" value="LONG_REST"/>
            <column name="created_at" valueComputed="CURRENT_TIMESTAMP"/>
            <column name="updated_at" valueComputed="CURRENT_TIMESTAMP"/>
        </insert>

        <!-- Shield of Faith -->
        <insert tableName="ability">
            <column name="ability_key" value="shield-of-faith"/>
            <column name="name" value="Shield of Faith"/>
            <column name="type" value="SPELL"/>
            <column name="class_restriction" value="Cleric"/>
            <column name="required_level" value="1"/>
            <column name="prerequisites" value=""/>
            <column name="effect" value="APPLY_STATUS:SHIELD:3:1:15"/>
            <column name="description" value="Grant a protective shield that absorbs 15 damage for 3 turns."/>
            <column name="spell_slot_level" valueNumeric="1"/>
            <column name="cooldown_seconds" valueNumeric="0"/>
            <column name="rest_type" value="LONG_REST"/>
            <column name="created_at" valueComputed="CURRENT_TIMESTAMP"/>
            <column name="updated_at" valueComputed="CURRENT_TIMESTAMP"/>
        </insert>

        <!-- Bless - Strength buff -->
        <insert tableName="ability">
            <column name="ability_key" value="bless"/>
            <column name="name" value="Bless"/>
            <column name="type" value="SPELL"/>
            <column name="class_restriction" value="Cleric"/>
            <column name="required_level" value="1"/>
            <column name="prerequisites" value=""/>
            <column name="effect" value="APPLY_STATUS:STRENGTH:4:1:20"/>
            <column name="description" value="Bless an ally, increasing their damage by 20% for 4 turns."/>
            <column name="spell_slot_level" valueNumeric="1"/>
            <column name="cooldown_seconds" valueNumeric="0"/>
            <column name="rest_type" value="LONG_REST"/>
            <column name="created_at" valueComputed="CURRENT_TIMESTAMP"/>
            <column name="updated_at" valueComputed="CURRENT_TIMESTAMP"/>
        </insert>

        <!-- Protection from Evil -->
        <insert tableName="ability">
            <column name="ability_key" value="protection-from-evil"/>
            <column name="name" value="Protection from Evil"/>
            <column name="type" value="SPELL"/>
            <column name="class_restriction" value="Cleric"/>
            <column name="required_level" value="1"/>
            <column name="prerequisites" value=""/>
            <column name="effect" value="APPLY_STATUS:PROTECTION:3:1:25"/>
            <column name="description" value="Reduce damage taken by 25% for 3 turns."/>
            <column name="spell_slot_level" valueNumeric="1"/>
            <column name="cooldown_seconds" valueNumeric="0"/>
            <column name="rest_type" value="LONG_REST"/>
            <column name="created_at" valueComputed="CURRENT_TIMESTAMP"/>
            <column name="updated_at" valueComputed="CURRENT_TIMESTAMP"/>
        </insert>
    </changeSet>

    <!-- Warrior Bleed and Vulnerability Skills -->
    <changeSet id="023-add-warrior-status-effect-skills" author="claude">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="ability"/>
        </preConditions>

        <!-- Rending Strike - Bleed -->
        <insert tableName="ability">
            <column name="ability_key" value="rending-strike"/>
            <column name="name" value="Rending Strike"/>
            <column name="type" value="SKILL"/>
            <column name="class_restriction" value="Warrior"/>
            <column name="required_level" value="1"/>
            <column name="prerequisites" value=""/>
            <column name="effect" value="DAMAGE+10,APPLY_STATUS:BLEED:3:1:3"/>
            <column name="description" value="A vicious strike that causes bleeding, dealing 10 damage + 3 damage per turn for 3 turns."/>
            <column name="spell_slot_level" valueNumeric="0"/>
            <column name="cooldown_seconds" valueNumeric="50"/>
            <column name="rest_type" value="SHORT_REST"/>
            <column name="created_at" valueComputed="CURRENT_TIMESTAMP"/>
            <column name="updated_at" valueComputed="CURRENT_TIMESTAMP"/>
        </insert>

        <!-- Sunder Armor - Vulnerability -->
        <insert tableName="ability">
            <column name="ability_key" value="sunder-armor"/>
            <column name="name" value="Sunder Armor"/>
            <column name="type" value="SKILL"/>
            <column name="class_restriction" value="Warrior"/>
            <column name="required_level" value="1"/>
            <column name="prerequisites" value=""/>
            <column name="effect" value="DAMAGE+6,APPLY_STATUS:VULNERABILITY:3:1:30"/>
            <column name="description" value="Shatter the enemy's defenses, dealing 6 damage and increasing damage they take by 30% for 3 turns."/>
            <column name="spell_slot_level" valueNumeric="0"/>
            <column name="cooldown_seconds" valueNumeric="60"/>
            <column name="rest_type" value="SHORT_REST"/>
            <column name="created_at" valueComputed="CURRENT_TIMESTAMP"/>
            <column name="updated_at" valueComputed="CURRENT_TIMESTAMP"/>
        </insert>
    </changeSet>

</databaseChangeLog>
